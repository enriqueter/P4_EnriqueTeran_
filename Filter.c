/*
 * Filter.c
 *
 *  Created on: 30 nov. 2020
 *      Author: Enrique Teran
 */


#include "Filter.h"
#include <stdio.h>
#include "board.h"
#include "peripherals.h"
#include "pin_mux.h"
#include "clock_config.h"
#include "MK66F18.h"
#include "fsl_debug_console.h"
/*Global variables to manage buffers and filters*/
float32_t *inputData, *outputData;
arm_fir_instance_f32 F[3];

/*Coefficients declarations*/
const float32_t Filter_LP_coefficients[NUM_COEF]  =
{
		0.000729144080436880,
		0.00103879167930554,
		0.00156260114951790,
		0.00239910525884799,
		0.00363803613929854,
		0.00535291270184113,
		0.00759433622221751,
		0.0103844881894790,
		0.0137132555169270,
		0.0175363076593737,
		0.0217753246276323,
		0.0263204328066998,
		0.0310347566424897,
		0.0357608490527831,
		0.0403286321011087,
		0.0445643714351422,
		0.0483001310642717,
		0.0513831149304534,
		0.0536843015489875,
		0.0551058180963226,
		0.0555865781937273,
		0.0551058180963226,
		0.0536843015489875,
		0.0513831149304534,
		0.0483001310642717,
		0.0445643714351422,
		0.0403286321011087,
		0.0357608490527831,
		0.0310347566424897,
		0.0263204328066998,
		0.0217753246276323,
		0.0175363076593737,
		0.0137132555169270,
		0.0103844881894790,
		0.00759433622221751,
		0.00535291270184113,
		0.00363803613929854,
		0.00239910525884799,
		0.00156260114951790,
		0.00103879167930554,
		0.000729144080436880
};

const float32_t Filter_BP_coefficients[NUM_COEF]  =
{


		0.000332328788036078,
		-0.00222202250278687,
		-0.000243468002361839,
		-0.00101472158107456,
		-0.00595865278850637,
		-0.000312510148644018,
		-0.00634412285171482,
		-0.0138927980335711,
		-0.000113682505740844,
		-0.0201232488986606,
		-0.0232290024699129,
		0.000571234290012407,
		-0.0458062732931645,
		-0.0260343547449853,
		0.00161523399161425,
		-0.0881905572907750,
		-0.00408259055674219,
		0.00257572893102040,
		-0.192256759106812,
		0.205971532840619,
		0.668701107586983,
		0.205971532840619,
		-0.192256759106812,
		0.00257572893102040,
		-0.00408259055674219,
		-0.0881905572907750,
		0.00161523399161425,
		-0.0260343547449853,
		-0.0458062732931645,
		0.000571234290012407,
		-0.0232290024699129,
		-0.0201232488986606,
		-0.000113682505740844,
		-0.0138927980335711,
		-0.00634412285171482,
		-0.000312510148644018,
		-0.00595865278850637,
		-0.00101472158107456,
		-0.000243468002361839,
		-0.00222202250278687,
		0.000332328788036078

};

const float32_t Filter_HP_coefficients[NUM_COEF]  =
{
		-0.000895563122672684,
		0.00142971656277340,
		-0.000959990719729866,
		-0.000830576299519983,
		0.00317700980798152,
		-0.00381206680268912,
		0.000514614058736733,
		0.00594112065004727,
		-0.0104553635406920,
		0.00668270518290038,
		0.00653290104454921,
		-0.0208598159982624,
		0.0220582308810007,
		-0.00143053927395064,
		-0.0327045351141002,
		0.0541736905305896,
		-0.0331293431801896,
		-0.0421888630994140,
		0.151601375969860,
		-0.249217468880266,
		0.288297132974930,
		-0.249217468880266,
		0.151601375969860,
		-0.0421888630994140	,
		-0.0331293431801896,
		0.0541736905305896,
		-0.0327045351141002,
		-0.00143053927395064,
		0.0220582308810007,
		-0.0208598159982624,
		0.00653290104454921,
		0.00668270518290038,
		-0.0104553635406920,
		0.00594112065004727,
		0.000514614058736733,
		-0.00381206680268912,
		0.00317700980798152,
		-0.000830576299519983,
		-0.000959990719729866,
		0.00142971656277340,
		-0.000895563122672684

};
void LP_Filter()
{
	arm_fir_init_f32(&F[0], NUM_COEF, (float32_t*)&Filter_LP_coefficients[0], &FilterState[0][0], DATA_SIZE);
}

void BP_Filter()
{
	arm_fir_init_f32(&F[1], NUM_COEF, (float32_t*)&Filter_BP_coefficients[0], &FilterState[1][0], DATA_SIZE);
}

void HP_Filter()
{
	arm_fir_init_f32(&F[2], NUM_COEF, (float32_t*)&Filter_HP_coefficients[0], &FilterState[2][0], DATA_SIZE);
}



void Filter_Initialization()
{

	/*Filter Initialization */
	LP_Filter();
	BP_Filter();
	HP_Filter();
}
void Filter_Process(uint8_t filter_type)
{
	uint32_t i;

	/* Filter Selection */
	switch(filter_type){
	case 0:
		for(i=0; i < DATA_SIZE; i++)
		{
		/* LP_FILTER */
		arm_fir_f32(&F[0], inputData + (4 * DATA_SIZE), outputData + (4 * DATA_SIZE), DATA_SIZE);
		PRINTF("LP FILTER ");
		}
		break;
	case 1:
		 	 	 	 /*Do nothing*/
		break;
	case 2:

		for(i=0; i < DATA_SIZE; i++)
		  {
				/* HP_FILTER */
				arm_fir_f32(&F[1], inputData + (4 * DATA_SIZE), outputData + (4 * DATA_SIZE), DATA_SIZE);
				PRINTF("BP FILTER  ");
		  }
		break;
	case 3:
					/*Do nothing*/
		break;
	case 4:

		for(i=0; i < DATA_SIZE; i++)
		{
			/* BP_FILTER */
			arm_fir_f32(&F[2], inputData + (4 * DATA_SIZE), outputData + (4 * DATA_SIZE), DATA_SIZE);
			PRINTF("HP FILTER  ");
		 }
		break;
	case 5:
			/* Do nothing*/
		break;
	default:

		break;
	}
}
